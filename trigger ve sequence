-- Trigger ve sequence için örnek
-- hesap tablosu
CREATE TABLE DEMOHESAP
(
   HESAP_ID       NUMBER (10),
   SAHIP_AD       VARCHAR2 (50),
   SAHIP_SOYAD    VARCHAR2 (50),
   ACILIS_TARIH   DATE,
   PRIMARY KEY (HESAP_ID)
)

-- hareket tablosu
CREATE TABLE DEMOHAREKET
(
   HAREKET_ID    NUMBER (12),
   HESAP_ID      NUMBER (10),
   YENI_BAKIYE   NUMBER (15, 5),
   ESKI_BAKIYE   NUMBER (15, 5),
   TARIH         DATE,
   IP            VARCHAR (30),
   PRIMARY KEY (HAREKET_ID),
   FOREIGN KEY (HESAP_ID) REFERENCES DEMOHESAP (HESAP_ID)
)

-- Oracle 12c ile beraber AUTO_INCREMENT çıktı
-- hesap tablosu için sequence
CREATE SEQUENCE DEMOHESAP_SEQ
   START WITH 1
   INCREMENT BY 1
   MAXVALUE 9999

-- hareket tablosu için sequence
CREATE SEQUENCE DEMOHAREKET_SEQ
   START WITH 1
   INCREMENT BY 1
   MAXVALUE 9999

-- hesap tablosu için trigger
CREATE TRIGGER DEMOHESAP_SEQ_TRIG
   BEFORE INSERT ON DEMOHESAP
   REFERENCING NEW AS NEW
   FOR EACH ROW
BEGIN
   SELECT DEMOHESAP_SEQ.NEXTVAL INTO :NEW.HESAP_ID FROM DUAL;
END;

-- hareket tablosu için trigger
CREATE OR REPLACE TRIGGER DEMOHAREKET_SEQ_TRIG
   BEFORE INSERT ON DEMOHAREKET
   REFERENCING NEW AS NEW
   FOR EACH ROW
BEGIN
   SELECT DEMOHAREKET_SEQ.NEXTVAL INTO :NEW.HAREKET_ID FROM DUAL;
END;
   
-- hesap için insert 
INSERT INTO DEMOHESAP
   (SAHIP_AD, SAHIP_SOYAD, ACILIS_TARIH)
VALUES
   ('cetin', 'coban', TO_DATE('10102015', 'DDMMYYYY'));

-- hareket için insert
INSERT INTO DEMOHAREKET
   (HESAP_ID, YENI_BAKIYE, ESKI_BAKIYE, TARIH, IP)
VALUES
   (2,
    1000,
    500,
    TO_DATE('10102015', 'DDMMYYYY'),
    UTL_INADDR.GET_HOST_ADDRESS);

SELECT * FROM DEMOHESAP
       
SELECT * FROM DEMOHAREKET
                
UPDATE DEMOHAREKET
   SET IP = UTL_INADDR.GET_HOST_ADDRESS
 WHERE HAREKET_ID = 2;
